var Z=Object.defineProperty;var U=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var q=(m,n,o)=>n in m?Z(m,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[n]=o,v=(m,n)=>{for(var o in n||(n={}))z.call(n,o)&&q(m,o,n[o]);if(U)for(var o of U(n))K.call(n,o)&&q(m,o,n[o]);return m};var F=(m,n,o)=>new Promise((B,p)=>{var E=d=>{try{t(o.next(d))}catch(w){p(w)}},x=d=>{try{t(o.throw(d))}catch(w){p(w)}},t=d=>d.done?B(d.value):Promise.resolve(d.value).then(E,x);t((o=o.apply(m,n)).next())});import{f as X,y as ee,v as ue,x as te,Y as g,A as oe,a4 as se,am as A,E as h,Z as ae,_ as re,k as ne,L as le,ax as ce,aQ as ie,o as O,n as k,g as s,w as i,h as M,a0 as W,p as y,i as D}from"./vendor.303085b1.js";/* empty css                  *//* empty css              */import{c as de,l as j}from"./oauth.d6d2153a.js";import{a as me,u as pe}from"./index.0cdc481d.js";import{b as fe,O as N}from"./oauth.fee3e4cd.js";import{u as Fe}from"./useValidator.9a78a0bb.js";const Be={class:"page-oauth-callback"},ge=y("div",{class:"w-full font-bold text-lg text-center text-gray-800 mb-6"},[y("span",null,"\u7B2C\u4E09\u65B9\u5E10\u53F7\u7ED1\u5B9A")],-1),he={key:0,class:"m-auto flex flex-col justify-start"},Ee=D(" \u767B\u5F55\u5E76\u7ED1\u5B9A\u5DF2\u6709\u8D26\u53F7 "),we={class:"mt-4 flex flex-row justify-center items-center"},_e=y("span",null,"\u6CA1\u6709\u8D26\u53F7\uFF1F",-1),Ce=D("\u7ACB\u5373\u6CE8\u518C"),ye={key:1,class:"m-auto flex flex-col justify-start"},ve=D(" \u6CE8\u518C\u5E76\u7ED1\u5B9A "),Ae={class:"mt-4 flex flex-row justify-center items-center"},De=y("span",null,"\u5DF2\u6709\u8D26\u53F7\uFF1F",-1),xe=D("\u70B9\u6B64\u7ED1\u5B9A"),Te=X({setup(m){const{t:n}=ee(),o=ue(),B=te(),p=me(),{validateAccount:E,validatePassword:x}=Fe(),t=`${o.params.provider}`.toUpperCase(),{code:d}=o.query,{type:w}=JSON.parse(fe.decode(`${o.query.state}`)),T=w==N.CONNECT?"\u7ED1\u5B9A":"\u767B\u5F55",I=g(!0),b=g(!0),$=g(null),R=g(),_=g({username:"",password:""}),P={username:[{trigger:"blur",asyncValidator:(a,e,u)=>F(this,null,function*(){e.trim()===""?u(new Error("\u8BF7\u8F93\u5165\u7528\u6237\u540D")):E(e)?E(e)&&!(yield p.checkExists(e))[0]?u(new Error("\u8BE5\u8D26\u53F7\u4E0D\u5B58\u5728")):u():u(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u8D26\u53F7"))})}],password:[{required:!0,trigger:"blur",min:6,max:16,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}]},S=g(),C=g({username:"",password:""}),G={username:[{trigger:"blur",asyncValidator:(a,e,u)=>F(this,null,function*(){e.trim()===""?u(new Error("\u8BF7\u8F93\u5165\u7528\u6237\u540D")):E(e)?E(e)&&(yield p.checkExists(e))[0]?u(new Error("\u8BE5\u7528\u6237\u540D\u5DF2\u5B58\u5728")):u():u(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u8D26\u53F7"))})}],password:[{required:!0,trigger:"blur",min:6,max:16,validator:(a,e,u)=>{e.trim()===""?u(new Error("\u8BF7\u8F93\u5165\u5BC6\u7801")):x(e)?u():u(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5BC6\u7801"))}}]};oe({title:`${t} ${T} - ${n("app_name")}`}),pe().setTitle(`${t} ${T}`),se(()=>{switch(w){case N.CONNECT:H();break;case N.LOGIN:J();break}});function V(a,e){return F(this,null,function*(){h.success(`${e} \u767B\u5F55\u6210\u529F`),p.setAccount(a.userInfo),p.setAuthToken(a.authToken),p.setOauthList(a.oauthList),B.replace({path:"/account/profile"})})}function H(){return F(this,null,function*(){var e;const a=A.service({fullscreen:!0,text:`\u6B63\u5728\u7ED1\u5B9A ${t} ...`,background:"rgba(255, 255, 255, 0.5)"});try{const{code:u,message:l,retCode:c}=yield de({channel:t,code:d,isWeb:!0});if(u==200&&c==0){const f=(e=p.oauthList)!=null?e:[];f.push(t),p.setOauthList(f),h.success(`${t} \u7ED1\u5B9A\u6210\u529F`);return}throw new Error(l)}catch(u){h.error(`${t} \u7ED1\u5B9A\u5931\u8D25: ${u.message}`)}finally{a.close(),B.replace({path:"/account/profile"})}})}function J(){return F(this,null,function*(){const a=A.service({fullscreen:!0,text:`\u6B63\u5728\u901A\u8FC7 ${t} \u767B\u5F55...`,background:"rgba(255, 255, 255, 0.5)"});try{const{code:e,data:u,message:l,retCode:c}=yield j({channel:t,code:d,isWeb:!0});if(e==200&&c==0){V(u,t);return}if(e===400&&c===2){h.info(`${t} \u767B\u5F55\u5931\u8D25, \u672A\u7ED1\u5B9A\u4E00\u4E2A\u6728\u51FD\u8D26\u53F7`),I.value=!1,$.value=u;return}throw new Error(l)}catch(e){h.error(`${t} \u767B\u5F55\u5931\u8D25: ${e.message}`),B.replace({path:"/account/login"})}finally{a.close()}})}function Q(){return F(this,null,function*(){var e;const a=A.service({fullscreen:!0,text:`\u6B63\u5728\u7ED1\u5B9A ${t} \u5E76\u767B\u5F55...`,background:"rgba(255, 255, 255, 0.5)"});try{if(!(yield(e=R.value)==null?void 0:e.validate()))return;const{code:u,data:l,message:c,retCode:f}=yield j(v(v({channel:t,code:d,isWeb:!0,shouldConnect:!0},$.value),_.value));if(u==200&&f==0){V(l,t);return}throw new Error(c)}catch(u){h.error(`${t} \u7ED1\u5B9A\u5931\u8D25: ${u.message}`),B.replace({path:"/account/login"})}finally{a.close()}})}function Y(){return F(this,null,function*(){var e;const a=A.service({fullscreen:!0,text:`\u6B63\u5728\u6CE8\u518C\u5E76\u7ED1\u5B9A ${t}...`,background:"rgba(255, 255, 255, 0.5)"});try{if(!(yield(e=S.value)==null?void 0:e.validate()))return;const{code:u,data:l,message:c,retCode:f}=yield j(v(v({channel:t,code:d,isWeb:!0,shouldReg:!0},$.value),C.value));if(u==200&&f==0){V(l,t);return}throw new Error(c)}catch(u){h.error(`${t} \u6CE8\u518C\u5931\u8D25: ${u.message}`),B.replace({path:"/account/login"})}finally{a.close()}})}return(a,e)=>{const u=ae,l=re,c=ne,f=le;return ce((O(),k("div",Be,[s(f,{class:"w-full max-w-360px m-auto flex flex-col justify-start p-4"},{default:i(()=>[ge,b.value?(O(),k("div",he,[s(M(W),{ref:(r,L)=>{L.connectAndLoginForm=r,R.value=r},model:_.value,rules:P,"label-position":"top"},{default:i(()=>[s(l,{label:"\u8D26\u53F7",prop:"username"},{default:i(()=>[s(u,{modelValue:_.value.username,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value.username=r),placeholder:"\u624B\u673A\u53F7/\u90AE\u7BB1/\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),s(l,{label:"\u5BC6\u7801",prop:"password"},{default:i(()=>[s(u,{type:"password",modelValue:_.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>_.value.password=r),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","show-password":""},null,8,["modelValue"])]),_:1}),s(l,{class:"mt-10"},{default:i(()=>[s(c,{type:"primary",class:"w-full",onClick:Q},{default:i(()=>[Ee]),_:1})]),_:1}),y("div",we,[_e,s(c,{type:"text",class:"ml-2",onClick:e[2]||(e[2]=r=>b.value=!1)},{default:i(()=>[Ce]),_:1})])]),_:1},8,["model"])])):(O(),k("div",ye,[s(M(W),{ref:(r,L)=>{L.registerAndLoginForm=r,S.value=r},model:C.value,rules:G,"label-position":"top"},{default:i(()=>[s(l,{label:"\u7528\u6237\u540D",prop:"username"},{default:i(()=>[s(u,{modelValue:C.value.username,"onUpdate:modelValue":e[3]||(e[3]=r=>C.value.username=r),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),s(l,{label:"\u5BC6\u7801",prop:"password"},{default:i(()=>[s(u,{type:"password",modelValue:C.value.password,"onUpdate:modelValue":e[4]||(e[4]=r=>C.value.password=r),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF086~16 \u4F4D\uFF09","show-password":""},null,8,["modelValue"])]),_:1}),s(l,{class:"mt-10"},{default:i(()=>[s(c,{type:"primary",class:"w-full",onClick:Y},{default:i(()=>[ve]),_:1})]),_:1}),y("div",Ae,[De,s(c,{type:"text",class:"ml-2",onClick:e[5]||(e[5]=r=>b.value=!0)},{default:i(()=>[xe]),_:1})])]),_:1},8,["model"])]))]),_:1})],512)),[[ie,!I.value]])}}});export{Te as default};
