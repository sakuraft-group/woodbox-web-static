var F=(g,N,s)=>new Promise((b,j)=>{var V=_=>{try{y(s.next(_))}catch(C){j(C)}},T=_=>{try{y(s.throw(_))}catch(C){j(C)}},y=_=>_.done?b(_.value):Promise.resolve(_.value).then(V,T);y((s=s.apply(g,N)).next())});import{f as de,y as fe,A as me,x as pe,Y as B,a4 as Ee,aa as _e,a5 as Fe,m as Be,r as ve,k as he,Z as Ce,_ as ye,ab as De,L as Ae,ac as ge,ad as xe,s as we,o as U,b as O,w as u,h as l,g as t,p as n,t as f,i as v,ae as be,a0 as q,af as je,ag as ke,ah as $e,ai as Ve,aj as Te,a8 as Le,a9 as Se,ak as Qe,j as Pe,R as Ue,S as Oe,al as z,E as p,am as H}from"./vendor.0a64e0b0.js";import{C as G,a as Ne,_ as Ie}from"./contact.5c8dfd8f.js";/* empty css               *//* empty css                  *//* empty css              *//* empty css               */import{_ as Me,b as We,u as ze,a as Re,d as qe,O as A,e as He,c as Y,s as Ge,f as Ye,g as Ze,h as Je}from"./index.98f0f520.js";import{d as Ke}from"./oauth.c1456d32.js";import{g as Xe,O as Z,a as eu}from"./oauth.fee3e4cd.js";import{u as uu}from"./useValidator.9a78a0bb.js";const h=g=>(Ue("data-v-2e00450e"),g=g(),Oe(),g),tu=h(()=>n("span",{class:"text-sm text-gray-500"},"\u7528\u6237\u540D\u53EF\u5305\u542B\u6570\u7EC4\u548C\u82F1\u6587\uFF0C4~15 \u4F4D\uFF0C\u4E0D\u80FD\u4E3A\u7EAF\u6570\u5B57",-1)),au={class:"flex flex-row items-center"},su=h(()=>n("span",{class:"text-sm text-gray-500"},"\u9000\u51FA\u8D26\u53F7",-1)),ou=h(()=>n("span",{class:"text-sm text-gray-500"},"\u7ED1\u5B9A\u624B\u673A\u6216\u90AE\u7BB1\uFF0C\u627E\u56DE\u5BC6\u7801\u66F4\u65B9\u4FBF",-1)),lu={class:"flex flex-row justify-start items-center"},nu={class:"text-sm"},cu={class:"flex flex-row justify-start items-center"},ru={class:"text-sm"},iu=h(()=>n("span",{class:"text-sm text-gray-500"},"\u7ED1\u5B9A\u7B2C\u4E09\u65B9\u8D26\u53F7\uFF0C\u767B\u5F55\u66F4\u5FEB\u6377",-1)),du={class:"flex flex-row justify-start items-center"},fu=h(()=>n("span",{class:"ml-2 text-md"}," QQ \u8D26\u53F7 ",-1)),mu={class:"text-sm"},pu={class:"flex flex-row justify-start items-center"},Eu=h(()=>n("span",{class:"ml-2 text-md"}," \u5FAE\u4FE1\u8D26\u53F7 ",-1)),_u={class:"text-sm"},Fu={class:"flex flex-row justify-start items-center"},Bu=h(()=>n("span",{class:"ml-2 text-md"}," Apple \u8D26\u53F7 ",-1)),vu={class:"text-sm"},hu={class:"text-sm text-gray-500"},Cu=h(()=>n("span",null,"\u5220\u9664\u8D26\u53F7",-1)),yu=h(()=>n("span",{class:"text-sm text-red-600"},"\u5220\u9664\u8D26\u53F7",-1)),Du=v(" \u53D6\u6D88 "),Au=v(" \u786E\u5B9A "),gu=de({setup(g){const{t:N}=fe();me({title:`\u8D26\u6237\u4E2D\u5FC3 - ${N("app_name")}`,script:We()}),ze().setTitle("\u8D26\u6237\u4E2D\u5FC3");const s=Re(),b=pe(),{validateUsername:j,validatePhoneNumber:V,validateEmail:T}=uu(),y=B(!1),_=B(!1),C=B(!1),L=B(!1),S=B(!1),I=B(!1),M=B(),x=B({username:""}),J={username:[{trigger:"blur",asyncValidator:(o,e,a)=>F(this,null,function*(){e.trim()===""?a(new Error("\u8BF7\u8F93\u5165\u7528\u6237\u540D")):j(e)?j(e)&&(yield s.checkExists(e))[0]?a(new Error("\u8BE5\u7528\u6237\u540D\u5DF2\u5B58\u5728")):a():a(new Error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u7528\u6237\u540D"))})}]},m=B(!1),D=B(!1),w=B(),d=B({contact:"",verifyCode:""}),K={verifyCode:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",length:4}],contact:[{trigger:"blur",asyncValidator:(o,e,a)=>F(this,null,function*(){(e==null?void 0:e.trim())===""?a(new Error(`\u8BF7\u8F93\u5165${m.value?"\u624B\u673A\u53F7":"\u90AE\u7BB1"}`)):(m.value?!V(e):!T(e))?a(new Error(`\u8BF7\u8F93\u5165\u6B63\u786E\u7684${m.value?"\u624B\u673A\u53F7":"\u90AE\u7BB1"}`)):(m.value?(yield s.checkExists(e))[0]:(yield s.checkExists(e))[0])?a(new Error(`\u8BE5${m.value?"\u624B\u673A\u53F7":"\u90AE\u7BB1"}\u5DF2\u88AB\u5176\u4ED6\u8D26\u53F7\u7ED1\u5B9A`)):a()})}]};Ee(()=>{ee(),s.fetchAccountProfile().then(o=>{(o==null?void 0:o.shouldLogout)===!0&&(b.replace("/account/login"),_e.warning("\u5F53\u524D\u4F1A\u8BDD\u5DF2\u5931\u6548\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"))})});function X(){return F(this,null,function*(){(yield z.confirm("\u662F\u5426\u786E\u8BA4\u9000\u51FA\u767B\u5F55\uFF1F","\u9000\u51FA\u767B\u5F55",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>!0).catch(()=>!1))&&(y.value=!0,yield s.logout(),y.value=!1,p.success("\u9000\u51FA\u767B\u5F55\u6210\u529F"),b.replace({path:"/account/login"}))})}function ee(){return F(this,null,function*(){const{code:o,data:e,retCode:a}=yield qe();o==200&&a===0&&e&&(I.value=!0)})}function ue(){return F(this,null,function*(){var o,e;L.value=!0;try{if(!(yield(o=M.value)==null?void 0:o.validate()))return;const{code:a,retCode:c,message:i}=yield He({username:x.value.username});a==200&&c===0?(p.success("\u4FEE\u6539\u7528\u6237\u540D\u6210\u529F"),s.$patch({account:{uname:x.value.username}}),S.value=!1,(e=M.value)==null||e.resetFields(),x.value.username="",I.value=!1):p.error(i)}catch(a){a||p.error(a.message)}finally{L.value=!1}})}function te(){return F(this,null,function*(){try{if(m.value?!V(d.value.contact):!T(d.value.contact))throw new Error(`\u8BF7\u8F93\u5165\u6B63\u786E\u7684${m.value?"\u624B\u673A\u53F7":"\u90AE\u7BB1"}`);const[o,e]=yield Y();if(!o)throw new Error(e);const{code:a,message:c,retCode:i}=yield Ge({channel:m.value?G.PHONE:G.EMAIL,codeType:Ne.UPDATE,target:d.value.contact,challenge:e});if(a!==200||i!==0)throw new Error(c);return p.success("\u9A8C\u8BC1\u7801\u53D1\u9001\u6210\u529F, 5 \u5206\u949F\u5185\u6709\u6548"),!0}catch(o){return p.error(`${o}`),!1}})}function ae(){return F(this,null,function*(){var o,e;_.value=!0;try{if(!(yield(o=w.value)==null?void 0:o.validate()))return;const{code:a,retCode:c,message:i}=yield Ye({phone:d.value.contact,code:d.value.verifyCode});a==200&&c===0?(p.success("\u624B\u673A\u53F7\u7ED1\u5B9A\u6210\u529F"),s.$patch({account:{phone:d.value.contact}}),D.value=!1,m.value=!1,(e=w.value)==null||e.resetFields(),d.value.contact="",d.value.verifyCode=""):p.error(i)}catch(a){a||p.error(a.message)}finally{_.value=!1}})}function se(){return F(this,null,function*(){var o,e;C.value=!0;try{if(!(yield(o=w.value)==null?void 0:o.validate()))return;const{code:a,retCode:c,message:i}=yield Ze({email:d.value.contact,code:d.value.verifyCode});a==200&&c===0?(p.success("\u90AE\u7BB1\u7ED1\u5B9A\u6210\u529F"),s.$patch({account:{email:d.value.contact}}),D.value=!1,m.value=!1,(e=w.value)==null||e.resetFields(),d.value.contact="",d.value.verifyCode=""):p.error(i)}catch(a){a||p.error(a.message)}finally{C.value=!1}})}function R(o){return F(this,null,function*(){var c;if(!(yield z.confirm(`\u662F\u5426\u89E3\u7ED1 ${o}`,"\u89E3\u9664\u7ED1\u5B9A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>!0).catch(()=>!1)))return;const a=H.service({fullscreen:!0,text:`\u6B63\u5728\u89E3\u7ED1 ${o}...`});try{const{code:i,retCode:E,message:k}=yield Ke({channel:o});i===200&&E===0?(p.success(`\u89E3\u7ED1 ${o} \u6210\u529F`),s.$patch({oauthList:(c=s.oauthList)==null?void 0:c.filter($=>$!==o)})):p.error(k)}catch(i){p.error(`${i.message}`)}finally{a.close()}})}function W(o){return F(this,null,function*(){let e="";switch(o){case A.QQ:e=eu(Z.CONNECT);break;case A.WECHAT:e=Xe(Z.CONNECT);break;default:e=window.location.href;break}window.open(e,"_self")})}function oe(){return F(this,null,function*(){if(!(yield z.confirm("\u82E5\u5DF2\u8D2D\u4F1A\u5458\uFF0C\u5220\u9664\u8D26\u6237\u5C06\u4E0D\u4E88\u9000\u6B3E\uFF0C\u662F\u5426\u786E\u8BA4\u5220\u9664\u8D26\u53F7\uFF1F","\u5220\u9664\u8D26\u53F7",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>!0).catch(()=>!1)))return;const[e]=yield Y();if(!e)return;const a=H.service({fullscreen:!0,text:"\u6B63\u5728\u5220\u9664\u8D26\u53F7..."});try{const{code:c,retCode:i,message:E}=yield Je();c===200&&i===0?(p.success("\u8D26\u53F7\u5220\u9664\u6210\u529F"),s.$patch({account:null,authToken:null,oauthList:null}),b.push("/")):p.error(E)}catch(c){p.error(`${c.message}`)}finally{a.close()}})}return(o,e)=>{const a=Fe,c=Be,i=ve("MdiSvg"),E=he,k=Ce,$=ye,le=De,Q=Ae,ne=ge,ce=Ie,re=xe,ie=we;return U(),O(c,{class:"page-account-profile",span:24},{default:u(()=>[l(s).isLoggedIn?(U(),O(ie,{key:0,span:24},{default:u(()=>[t(Q,{class:"container-content-section pt-6 pl-4 pr-4"},{default:u(()=>[t(c,{span:24,justify:"center"},{default:u(()=>[t(a,{size:72,src:`https://avatars.dicebear.com/api/bottts/${l(s).uid}.svg`},null,8,["src"])]),_:1}),S.value?(U(),O(c,{key:1,class:"mt-8 w-full max-w-360px m-auto"},{default:u(()=>[t(l(q),{ref:(r,P)=>{P.usernameEditForm=r,M.value=r},model:x.value,rules:J},{default:u(()=>[t($,{prop:"username"},{default:u(()=>[t(k,{modelValue:x.value.username,"onUpdate:modelValue":e[2]||(e[2]=r=>x.value.username=r),placeholder:l(s).username},{suffix:u(()=>[t(E,{type:"text",size:"small",onClick:e[1]||(e[1]=r=>S.value=!1),disabled:L.value},{default:u(()=>[t(i,null,{default:u(()=>[v(f(l(je)),1)]),_:1})]),_:1},8,["disabled"]),t(E,{type:"text",size:"small",onClick:ue,loading:L.value},{default:u(()=>[t(i,null,{default:u(()=>[v(f(l(ke)),1)]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue","placeholder"]),tu]),_:1})]),_:1},8,["model"])]),_:1})):(U(),O(c,{key:0,span:24,justify:"center",class:"mt-6 items-center"},{default:u(()=>{var r;return[n("span",null,f((r=l(s).username)!=null?r:"\u672A\u8BBE\u7F6E\u7528\u6237\u540D"),1),t(E,{type:"text",size:"small",disabled:!I.value,onClick:e[0]||(e[0]=P=>S.value=!0)},{default:u(()=>[t(i,{class:"ml-1"},{default:u(()=>[v(f(l(be)),1)]),_:1})]),_:1},8,["disabled"])]}),_:1})),t(c,{span:24,justify:"center",align:"middle",class:"mt-2 text-sm text-gray-500"},{default:u(()=>[n("span",null,"ID "+f(l(s).uid),1),t(le,{direction:"vertical"}),n("span",au,[t(i,{class:"mr-1"},{default:u(()=>[v(f(l($e)),1)]),_:1}),v(" "+f(o.$t(l(s).membershipDesc)),1)])]),_:1}),t(c,{justify:"end",class:"mt-6",align:"middle"},{default:u(()=>[t(E,{type:"text",class:"cursor-pointer",onClick:X,loading:y.value},{default:u(()=>[su]),_:1},8,["loading"])]),_:1})]),_:1}),t(Q,{class:"container-content-section pt-2 pl-4 pr-4"},{default:u(()=>[ou,t(c,{justify:"space-between",class:"mt-4"},{default:u(()=>{var r;return[n("div",lu,[t(i,{class:"mr-2"},{default:u(()=>[v(f(l(Ve)),1)]),_:1}),n("span",null,f((r=l(s).phone)!=null?r:"\u672A\u7ED1\u5B9A\u624B\u673A"),1)]),t(E,{type:"text",onClick:e[3]||(e[3]=()=>{D.value=!0,m.value=!0})},{default:u(()=>[n("span",nu,f(l(s).phone?"\u66F4\u6362\u624B\u673A":"\u7ED1\u5B9A\u624B\u673A"),1)]),_:1})]}),_:1}),t(c,{justify:"space-between"},{default:u(()=>{var r;return[n("div",cu,[t(i,{class:"mr-2"},{default:u(()=>[v(f(l(Te)),1)]),_:1}),n("span",null,f((r=l(s).email)!=null?r:"\u672A\u7ED1\u5B9A\u90AE\u7BB1"),1)]),t(E,{type:"text",onClick:e[4]||(e[4]=()=>{D.value=!0,m.value=!1})},{default:u(()=>[n("span",ru,f(l(s).email?"\u66F4\u6362\u90AE\u7BB1":"\u7ED1\u5B9A\u90AE\u7BB1"),1)]),_:1})]}),_:1})]),_:1}),t(Q,{class:"container-content-section card-oauth pt-2 pl-4 pr-4"},{default:u(()=>[iu,t(c,{justify:"space-between",class:"mt-4"},{default:u(()=>[n("div",du,[t(a,{class:"icon-qq",size:"medium"},{default:u(()=>[t(i,{class:"block"},{default:u(()=>[v(f(l(Le)),1)]),_:1})]),_:1}),fu]),n("div",null,[t(E,{type:"text",class:"cursor-pointer",onClick:e[5]||(e[5]=()=>{l(s).didConnectQQ?R(l(A).QQ):W(l(A).QQ)})},{default:u(()=>[n("span",mu,f(l(s).didConnectQQ?"\u89E3\u9664\u7ED1\u5B9A":"\u53BB\u7ED1\u5B9A"),1)]),_:1})])]),_:1}),t(c,{justify:"space-between",class:"mt-4"},{default:u(()=>[n("div",pu,[t(a,{class:"icon-wechat",size:"medium"},{default:u(()=>[t(i,{class:"block"},{default:u(()=>[v(f(l(Se)),1)]),_:1})]),_:1}),Eu]),n("div",null,[t(E,{type:"text",class:"cursor-pointer",onClick:e[6]||(e[6]=()=>{l(s).didConnectWeChat?R(l(A).WECHAT):W(l(A).WECHAT)})},{default:u(()=>[n("span",_u,f(l(s).didConnectWeChat?"\u89E3\u9664\u7ED1\u5B9A":"\u53BB\u7ED1\u5B9A"),1)]),_:1})])]),_:1}),t(c,{justify:"space-between",class:"mt-4"},{default:u(()=>[n("div",Fu,[t(a,{class:"icon-apple",size:"medium"},{default:u(()=>[t(i,{class:"block"},{default:u(()=>[v(f(l(Qe)),1)]),_:1})]),_:1}),Bu]),n("div",null,[t(E,{type:"text",class:"cursor-pointer",onClick:e[7]||(e[7]=r=>W(l(A).APPLE))},{default:u(()=>[n("span",vu,f(l(s).didConnectApple?"\u89E3\u9664\u7ED1\u5B9A":"\u53BB\u7ED1\u5B9A"),1)]),_:1})])]),_:1})]),_:1}),t(Q,{class:"container-content-section card-danger p-4 mb-8"},{default:u(()=>[n("span",hu,"\u5220\u9664\u6240\u6709\u6570\u636E\uFF0C\u6C38\u4E45\u6CE8\u9500\u300A"+f(o.$t("app_name"))+"\u300B\u5E10\u53F7",1),t(c,{justify:"space-between",class:"mt-4 items-center"},{default:u(()=>[Cu,t(ne,{"confirm-button-text":"\u786E\u8BA4","cancel-button-text":"\u53D6\u6D88","confirm-button-type":"danger","icon-color":"red",title:"\u8D26\u53F7\u4E00\u7ECF\u5220\u9664\u4E0D\u53EF\u6062\u590D\uFF0C\u662F\u5426\u786E\u8BA4\u5220\u9664\uFF1F",onConfirm:oe},{reference:u(()=>[t(E,{type:"text"},{default:u(()=>[yu]),_:1})]),_:1})]),_:1})]),_:1}),t(re,{modelValue:D.value,"onUpdate:modelValue":e[12]||(e[12]=r=>D.value=r),title:m.value?l(s).phone?"\u66F4\u6362\u624B\u673A":"\u7ED1\u5B9A\u624B\u673A":l(s).email?"\u66F4\u6362\u90AE\u7BB1":"\u7ED1\u5B9A\u90AE\u7BB1",width:"95%","custom-class":"max-w-384px","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:u(()=>[t(E,{disabled:m.value?_.value:C.value,onClick:e[10]||(e[10]=()=>{var r;D.value=!1,m.value=!1,(r=w.value)==null||r.resetFields(),d.value.contact="",d.value.verifyCode=""})},{default:u(()=>[Du]),_:1},8,["disabled"]),t(E,{type:"primary",onClick:e[11]||(e[11]=()=>{m.value?ae():se()}),loading:m.value?_.value:C.value},{default:u(()=>[Au]),_:1},8,["loading"])]),default:u(()=>[t(l(q),{ref:(r,P)=>{P.securityContactForm=r,w.value=r},model:d.value,rules:K,class:"pl-4 pr-4"},{default:u(()=>[t($,{prop:"contact"},{default:u(()=>[t(k,{modelValue:d.value.contact,"onUpdate:modelValue":e[8]||(e[8]=r=>d.value.contact=r),placeholder:`\u8BF7\u8F93\u5165${m.value?"\u624B\u673A\u53F7":"\u90AE\u7BB1"}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1}),t($,{prop:"verifyCode"},{default:u(()=>[t(k,{modelValue:d.value.verifyCode,"onUpdate:modelValue":e[9]||(e[9]=r=>d.value.verifyCode=r),placeholder:"\u5B89\u5168\u9A8C\u8BC1\u7801",autocomplete:"off"},{append:u(()=>[t(ce,{onSend:te})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})):Pe("",!0)]),_:1})}}});var Pu=Me(gu,[["__scopeId","data-v-2e00450e"]]);export{Pu as default};
